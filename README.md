# 1. Разработка модели процессорного ядра программно-аппаратного комплекса

### Цель лабораторной работы

Целью данной лабораторной работы является освоение маршрута проектирования процессорных ядер на уровне системного моделирования путем разработки модели процессорного ядра на языке программирования высокого уровня.

### Задание на лабораторную работу

Разработать проект в виде консольного или графического приложения на языке программирования высокого уровня.
Проект заключается в описании модели регистров и памяти процессора, а также проверки модели путем составления тестовой программы с предсказуемым результатом исполнения.
После записи команд тестовой программы в массив, имитирующий память процессора, запуск модели должен привести к пошаговому моделированию состояний процессора при выполнении каждой из команд.
Корректность модели и программы определяется достижением заранее определенного результата вычислений.

### Ход работы

В соответствии с индивидуальным заданием на выполнение лабораторной работы была разработана модель процессора с двухадресной адресацией и архитектурой фон Неймана, а также тестовая программа для нахождения максимального элемента в массиве целых чисел.

Созданная модель содержит следующие регистры:

- EAX, EBX, ECX, EDX, ESI, EDI, EBP – регистры общего назначения

- EIP – счетчик команд

Созданная модель содержит следующие Флаги:

- ZF – Флаг нуля

- CF – Флаг переноса

- SF – Флаг знака

Созданная модель содержит следующие инструкции:

| Команда  | Первый операнд | Второй операнд | Описание команды                                          |
|----------|----------------|----------------|-----------------------------------------------------------|
| MOV_RM   | Регистр        | Литерал        | Копировать значение по адресу второго операнда в регистр  |
| MOV_RL   | Регистр        | Литерал        | Копировать литерал в регистр                              |
| MOV_RT   | Регистр        | Регистр        | Копировать значение по адресу в регистре в регистр        |
| CMP_RR   | Регистр        | Регистр        | Сравнение значения двух регистров                         |
| ADD_RL   | Регистр        | Литерал        | Прибавить литерал к значению регистра                     |
| SUB_RL   | Регистр        | Литерал        | Вычесть литерал от значения регистра                      |
| JZ_R     | Литерал        | Нет            | Условный переход (ZF = 1)                                 |
| TEST_RR  | Регистр        | Регистр        | Побитовое И двух регистров, меняет только флаги           |
|CMOV_GT_RR| Регистр        | Регистр        | Условное копирование из регистра в регистр (SF = 1)       |
| HALT     | Нет            | Нет            | Завершить работу ВМ                                       |

Структура команд созданной модели:

Команды состоят из 4 байт, первый байт выделен для кода команды, второй байт для первого операнда, оставшиеся два байта для второго операнда или литерала. 

XXXX XXXX YYYY YYYY ZZZZ ZZZZ LLLL LLLL

XXXX XXXX  – код команды

YYYY YYYY – первый операнд (при наличии)

ZZZZ ZZZZ – второй операнд (при наличии)

ZZZZ ZZZZ LLLL LLLL – литерал (при наличии)

Также, было проведено испытание разработанной модели на тестовой программе для нахождения максимального элемента массива.

Код тестовой программы:

```
MOV_RM ecx 0x4000
MOV_RL ebx 0x4004
MOV_RT edx ebx
CMP_RR eax edx
CMOV_GT_RR eax edx
ADD_RL ebx 0x4
SUB_RL ecx 0x1
TEST_RR ecx ecx
JZ_R 0x4
SUB_RL eip 0x20
HALT
```

Результат выполнения:

```
EAX:    0x0000ded0    EBX:    0x00004030    ECX:    0000000000    ZF:    1
EDX:    0x00008373    EIP:    0x00000028    CMD:    0x0d000000    SF:    0
ESI:    0000000000    EDI:    0000000000    EBP:    0000000000    CF:    0
```

В результате выполнения тестовой программы был корректно найдена максимальный элемент заранее определенного массива чисел.

### Вывод

В ходе выполнения лабораторной работы были изучены существующие модели процессоров, включая их архитектуру, регистровые модели и формат команд, а также разработана модель процессорного ядра на языке программирования высокого уровня в соответствии с индивидуальным заданием.

# 2. Разработка модели аппаратного ускорителя вычислений для программно-аппаратного комплекса

### Цель лабораторной работы

Целью лабораторной работы является разработка аппаратного ускорителя вычислений на языке программирования высокого уровня.

### Задание на лабораторную работу

Проект для лабораторной работы представляет собой программу в виде консольного или графического приложения на языке программирования высокого уровня.
Проект заключается в разработке программы, имитирующей работу аппаратного ускорителя в составе программно-аппаратного комплекса.

К разработанной в первой лабораторной работе модели процессора необходимо добавить команды умножения и сложения с учетом бита переноса а также разработать тестовую программу, выполняющую свертку двух массивов одинаковой длины.

### Ход работы

В разработанной ранее модели в соответствии с заданием на выполнение лабораторной работы были реализованы команды MUL_RR и ADC_RR.

Команда ADC_RR выполняет сложение значений двух регистров и флага CF.
После выполнения этой операции значение флага CF устанавливается равным 0.

Команда MUL_RR выполняет умножение значения двух регистров, результат вычисления представляет собой 8 байт, поэтому старшие 4 байта копируются в регистр второго операнда, а младшие 4 байта в регистр первого операнда.

Также была разработана программа, выполняющая свертку двух массивов целых положительных чисел одинаковой длины.

Код программы:

```
MOV_RM ecx 0x4000
MOV_RL ebp 0x4004
MOV_RL edx 0x5004
MOV_RT esi ebp
ADD_RL ebp 0x4
MOV_RT edi edx
ADD_RL edx 0x4
MUL_RR esi edi
ADD_RR ebx edi
ADC_RR eax esi
SUB_RL ecx 0x1
TEST_RR ecx ecx
JZ_R 0x4
SUB_RL eip 0x2C
HALT
```

Результат выполнения:

```
EAX:    0x00000002    EBX:    0xa3e7665a    ECX:    0000000000    ZF:    1
EDX:    0x00005030    EIP:    0x00000038    CMD:    0x0d000000    SF:    0
ESI:    0000000000    EDI:    0x72690ae3    EBP:    0x00004030    CF:    0
```

В результате выполнения тестовой программы была корректно найдена свертка заранее определенных массивов чисел.

### Вывод

В ходе выполнения лабораторной работы в разработанную модель процессора были добавлены команды умножения и сложения с учетом бита переноса, а также реализована программа, выполняющая свертку двух массивов одинаковой длины.

# 3. Разработка ассемблера для модели процессора

### Цель лабораторной работы

Целью лабораторной работы является разработка ассемблера для модели процессора на языке программирования высокого уровня.

### Задание на лабораторную работу

Разработать программу в виде консольного или графического приложения на языке программирования высокого уровня, преобразующую исходный текст программы на языке ассемблера в машинные коды процессора, реализованного в виде модели.

### Ход работы

В рамках данной лабораторной работы был разработан ассемблер для созданной модели процессора.

Синтаксис команд имеет следующую структуру:
`<команда> <первый операнд> <второй операнд>`
, т.е. в начале строки находится обозначение команды и через пробелы после него два операнда.

Алгоритм ассемблирования представляет собой следующий процесс:

1. Построчно считывается файл с ассемблерными командами

2. Каждая считанная строка синтаксически анализируется

3. На основании проведенного синтаксического анализа формируется машинный код команды разработанной модели процессора.

Результат ассемблирования программы, выполняющей вычисление свертки двух массивов:

```
Command: MOV_RM ; OP1: ecx; OP2: 0x4000; Opcode: 0x01024000
Command: MOV_RL ; OP1: ebp; OP2: 0x4004; Opcode: 0x02074004
Command: MOV_RL ; OP1: edx; OP2: 0x5004; Opcode: 0x02035004
Command: MOV_RT ; OP1: esi; OP2: ebp   ; Opcode: 0x03050700
Command: ADD_RL ; OP1: ebp; OP2: 0x4   ; Opcode: 0x05070004
Command: MOV_RT ; OP1: edi; OP2: edx   ; Opcode: 0x03060300
Command: ADD_RL ; OP1: edx; OP2: 0x4   ; Opcode: 0x05030004
Command: MUL_RR ; OP1: esi; OP2: edi   ; Opcode: 0x0c050600
Command: ADD_RR ; OP1: ebx; OP2: edi   ; Opcode: 0x0a010600
Command: ADC_RR ; OP1: eax; OP2: esi   ; Opcode: 0x0b000500
Command: SUB_RL ; OP1: ecx; OP2: 0x1   ; Opcode: 0x06020001
Command: TEST_RR; OP1: ecx; OP2: ecx   ; Opcode: 0x08020200
Command: JZ_R   ; OP1: 0x4; OP2:       ; Opcode: 0x07000004
Command: SUB_RL ; OP1: eip; OP2: 0x2C  ; Opcode: 0x0604002c
Command: HALT   ; OP1:    ; OP2:       ; Opcode: 0x0d000000
```

### Вывод

В ходе выполнения лабораторной работы были изучены общие принципы работы компиляторов, а также разработан ассемблер для реализованной модели процессора.
